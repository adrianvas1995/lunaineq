% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rg_luna.R
\name{rg_luna}
\alias{rg_luna}
\title{Relative inequality gap (two input modes)}
\usage{
rg_luna(
  health_indicator_type = NULL,
  health_indicator = NULL,
  population_weights = NULL,
  health_numerator = NULL,
  health_denominator = NULL,
  equity_stratifier = NULL,
  higher_ineq_is_favorable = NULL,
  rate_scaling_factor = NULL,
  grouping_method = NULL,
  n_groups = NULL,
  manual_breaks = NULL,
  conf_level = NULL,
  language_interpretation = NULL
)
}
\arguments{
\item{health_indicator_type}{Character string: either \code{"proportion"} for bounded indicators in \eqn{[0,1]}, or \code{"rate"} if already scaled (e.g., deaths per 100,000); required in all cases.}

\item{health_indicator}{Numeric vector with the health indicator values (e.g., \code{c(0.12, 0.34)} for proportions or \code{c(120, 345)} for rates); aggregated value per unit; used only in Mode B.}

\item{population_weights}{Numeric vector > 0 representing population size or weight per unit (e.g., \code{c(1000, 5000, 1200)}); used only in Mode B.}

\item{health_numerator}{Numeric vector with event counts (e.g., \code{c(5, 12, 8)} for deaths); used only in Mode A and preferred for robust estimation.}

\item{health_denominator}{Numeric vector > 0 associated with \code{health_numerator} (e.g., \code{c(500, 1000, 800)} representing population at risk); used only in Mode A.}

\item{equity_stratifier}{Numeric vector representing the social stratifier (e.g., poverty rate, education index); required in all cases.}

\item{higher_ineq_is_favorable}{Logical; \code{TRUE} if higher values of \code{equity_stratifier} indicate better social conditions (e.g., Gross Domestic Product per capita), or \code{FALSE} if they indicate worse conditions (e.g., Unsatisfied Basic Needs).}

\item{rate_scaling_factor}{Numeric scalar > 0 applied only when \code{health_indicator_type = "rate"}; commonly \code{1000} or \code{100000} (e.g., maternal mortality ratio per 100000 live births).}

\item{grouping_method}{String defining how to group the social stratifier: \code{"quantiles"}, \code{"equal intervals"}, \code{"manual intervals"}, \code{"k-means"}, \code{"hierarchical clustering"}, \code{"bagging clustering"}, \code{"fisher-jenks"}, \code{"jenks"}, or \code{"maximum differences"}.}

\item{n_groups}{Integer ≥ 2 specifying the number of social groups to create; ignored if \code{grouping_method = "manual intervals"}.}

\item{manual_breaks}{Numeric vector defining custom cut points (e.g., \code{c(20, 40)} defines intervals \code{0–20}, \code{20–40}, and \code{40+}); used only when \code{grouping_method = "manual intervals"}.}

\item{conf_level}{Numeric scalar between 0 and 1 (e.g., \code{0.95}) specifying the confidence level for inequality estimates; default is \code{0.95}.}

\item{language_interpretation}{Character string indicating the desired output language for interpretation and note; allowed values are \code{"en"}, \code{"es"}, \code{"fr"}, \code{"pt"} or full names (\code{"english"}, \code{"spanish"}, \code{"french"}, \code{"portuguese"}); default is \code{"en"}.}
}
\value{
A \code{list} with the following components:
\item{summary_table}{A \code{tibble} with the inequality metric name (\code{inequality_metric}), the estimated relative gap (\code{value}), and its confidence interval bounds (\code{ci_lower}, \code{ci_upper}).}
\item{interpretation}{Character string with the automatic interpretation of the result in the selected language.}
\item{note}{Character string with the explanatory note in the selected language, based on the type of health indicator.}
\item{group_summary}{\code{tibble} summarizing the indicator for each social group. Contains either weighted means (Mode B) or raw counts and denominators (Mode A).}
\item{global_health_mean}{Overall mean of the health indicator: weighted average (Mode B) or global rate (Mode A).}
\item{data}{Final \code{tibble} used for the calculation, including processed variables and groupings.}
}
\description{
Computes the relative inequality gap between the extreme social groups defined based on a
numeric equity stratifier. The function operates in two modes: \strong{(Mode A)} using a numerator and
denominator (\code{health_numerator} and \code{health_denominator}), which is the preferred
and most accurate method, as it relies directly on event counts;
and \strong{(Mode B)} using an aggregated health indicator (\code{health_indicator})
and population weights (\code{population_weights}), which approximates the gap based on weighted group means.
The function also provides automatic interpretations of the results in
four languages: Spanish, English, French, and Portuguese.
}
\details{
In both cases, the social stratifier is grouped into \code{n_groups} using the selected method (e.g., quantiles),
ensuring that \emph{group 1} corresponds to the most disadvantaged group and the last group to the most advantaged
(as defined by \code{higher_ineq_is_favorable}). The relative gap is calculated as the ratio in the health indicator \eqn{y}
—defined as the mean value of the indicator within each group— between the most disadvantaged and the most advantaged groups: \eqn{\mathrm{RG} = y_{\text{disadvantaged}} / y_{\text{advantaged}}}.

\subsection{A) Using numerator and denominator (preferred)}{
When \code{health_numerator} and \code{health_denominator} are provided (Mode A), the function uses actual event counts to compute the relative inequality gap and its confidence interval.

\itemize{
\item \strong{Proportions}: The function computes the ratio between the proportions of events in the most disadvantaged and most advantaged groups. Confidence intervals are estimated using \code{epitools::riskratio()}, which implements score-based methods for risk ratios (relative risks) from 2x2 tables.

\item \strong{Rates}: The function computes the rate ratio between the two extreme groups. It assumes Poisson-distributed event counts, and confidence intervals are estimated using \code{ratesci::scoreci()} with \code{distrib = "poi"} and \code{contrast = "RR"}, which applies a skewed score-based method for rate ratios.

\item \emph{This mode does not rely on population weights}; the inference is based directly on count-level data, yielding more robust and reliable results.
}
}

\subsection{B) With aggregated indicator weighted by population (approximate)}{
When only aggregate indicators and population weights are available (Mode B), the function approximates the relative gap and its confidence interval using group-level means.

\itemize{
\item \strong{Proportions}: The function computes the ratio between the weighted group means. The confidence interval is estimated using a log-transformed Wald method for independent proportions.

\item \strong{Rates}: The function computes the rate ratio using estimated event counts derived from the scaled rate and population. The confidence interval is computed using a Wald approximation in the log scale.

\item \emph{Warning}: This approach assumes independence and large sample sizes; it may underestimate or overestimate variability, particularly in the presence of aggregation, small counts, or heterogeneity. Use Mode A when possible.
}}
}
\note{
Mode B was developed as an alternative for situations where only aggregated
health indicators (e.g., proportions or rates) are available, and the disaggregated
data (numerator and denominator) is not accessible. Although Mode A is more precise,
Mode B still allows for valid inequality comparisons when only summary data is available.
}
\examples{
# ——— Mode A (preferred: numerator and denominator) ———

# Health indicator: Rate. Suppose data1 with:
#   maternal_deaths  = number of maternal deaths.
#   live_births      = number of live births.
#   ubn_percent      = \% of population with at least one unmet basic need (higher = worse social status).
data(data1)
rg_luna(
  health_indicator_type    = "rate",
  health_numerator         = data1$maternal_deaths,
  health_denominator       = data1$live_births,
  equity_stratifier        = data1$ubn_percent,
  higher_ineq_is_favorable = FALSE,
  rate_scaling_factor      = 100000,
  grouping_method          = "quantiles",
  n_groups                 = 4,
  conf_level               = 0.95,
  language_interpretation = "en"
)

# Health indicator: Proportion. Suppose data2 with:
#   skilled_births   = number of births attended by skilled personnel.
#   total_births     = total number of births.
#   ubn_index        = \% of population with at least one unmet basic need (higher = worse social status).
rg_luna(
  health_indicator_type    = "proportion",
  health_numerator         = data2$skilled_births,
  health_denominator       = data2$total_births,
  equity_stratifier        = data2$ubn_percent,
  higher_ineq_is_favorable = FALSE,
  grouping_method          = "quantiles",
  n_groups                 = 4,
  conf_level               = 0.95,
  language_interpretation = "en"
)

# ——— Mode B (aggregated indicator + population as weight) ———

# Suppose data1 with:
#   mmr       = maternal mortality ratio per 100,000 live births.
#   population = population weight of the unit of analysis.
#   ubn_index = \% of population with at least one unmet basic need.
rg_luna(
  health_indicator_type    = "rate",
  health_indicator         = data1$mmr,
  equity_stratifier        = data1$ubn_percent,
  population_weights       = data1$population_zone,
  higher_ineq_is_favorable = FALSE,
  rate_scaling_factor      = 100000,
  grouping_method          = "quantiles",
  n_groups                 = 4,
  conf_level               = 0.95,
  language_interpretation = "en"
)

# Suppose data2 with:
#   skilled_births_prop = proportion of births attended by skilled personnel (in [0,1]).
#   population           = population weight of the unit of analysis.
#   ubn_index            = \% of population with at least one unmet basic need.
rg_luna(
  health_indicator_type    = "proportion",
  health_indicator         = data2$skilled_births_prop,
  equity_stratifier        = data2$ubn_percent,
  population_weights       = data2$population,
  higher_ineq_is_favorable = FALSE,
  grouping_method          = "quantiles",
  n_groups                 = 4,
  conf_level               = 0.95,
  language_interpretation = "en"
)

}
\references{
World Health Organization. Handbook on health inequality monitoring with a special focus on low- and middle-income countries. 2013.
Available from: https://www.who.int/publications/i/item/9789241548632
}
\seealso{
\code{epiR::epi.2by2}, \code{ratesci::scoreci}, \code{classInt::classIntervals}
}
\author{
Adrián Vázquez-Mejía, MD MSc(c) (\email{apvasquez.md@gmail.com})
\cr Independent Consultant

Oscar J. Mújica, MD MPH (\email{mujicaos@paho.org})
\cr Pan American Health Organization (PAHO), Washington D.C.

Antonio Sanhueza, PhD (\email{sanhueza@paho.org})
\cr Pan American Health Organization (PAHO), Washington D.C.
}
